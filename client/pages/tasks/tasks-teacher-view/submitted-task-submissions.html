<style>
    td, th{
        border-width: 2px !important;
    }

    tr:hover {
        background-color: white !important;
    }
</style>

<h5 style="margin-bottom: -14px;"><i class="bi bi-folder-check" style="margin-right: 5px; font-size: 20px; vertical-align: bottom;"></i>Abgaben</i></h5>
<hr size="4" style="color: purple; opacity: 80%;">

<h4 id="noSubmissionsMessage" class="text-muted" style="display: none; text-align: center; margin-top: 2em; margin-bottom: 2rem;">Keine Abgaben</h4>


    <div style="overflow: hidden; white-space: nowrap; display: block;  overflow-x: auto;">
        <table class="table align-middle">
            <tbody id="submissionsTableContent">

                <!-- submissions go here -->

            </tbody>
        </table>
    </div>


<script>

    function downloadSubmissionFile(submissionId) {
        window.location = "/ss22-itp-g02/backend/requestHandler.php?method=downloadSubmissionFile&submission_id=" + submissionId;
    }

    function displaySubmission(submission) {

        creationTime = new Date(submission["creation_time"]);
        creationTimeYear = creationTime.getFullYear() % 2000;
        creationTimeMonth = new String(creationTime.getMonth() + 1).padStart(2, '0');
        creationTimeDay = new String(creationTime.getDate()).padStart(2, '0');
        creationTimeHours = new String(creationTime.getHours()).padStart(2, '0');
        creationTimeMinutes = new String(creationTime.getMinutes()).padStart(2, '0');
        creationTimeString = creationTimeDay + "." + creationTimeMonth + "." + creationTimeYear + " - " + creationTimeHours + ":" + creationTimeMinutes;

        tableEntry = document.createElement("tr");
        $(tableEntry).html(`
            <td><div style="display: flex; align-items: center;"><i class="bi bi-person-circle text-muted" style="font-size: 2rem; margin-bottom: -25px; margin-top: -21.5px;"></i>
                    <span style="vertical-align: middle; margin: 1px 0 0 7px;">
                        <span style="font-weight: bold;" id="firstName">${submission["first_name"]}</span>
                        <span style="font-weight: bold;"> </span>
                        <span style="font-weight: bold;" id="lastName">${submission["last_name"]}</span>
                        <span style="margin-left: 3px" class="text-muted" id="userName">${submission["user_name"]}</span>
                    </span>
                </div>
            </td>
            <td class="text-center">${creationTimeString}</td>
            <td class="text-center"><button onclick="downloadSubmissionFile(${submission["submission_id"]})" type="button" id="taskDescriptionfile" style="background-color: #eee;" class="btn btn-light"> <i style="color: purple;" class="bi bi-file-earmark-text"></i> Abgabe</button></td>
        `)
    
    $("#submissionsTableContent").prepend(tableEntry);

    }

    $.ajax({
        type: "POST",
        url: "/ss22-itp-g02/backend/requestHandler.php",
        data: {method: "getSubmissions", assignment_id: assignmentId},
        cache: false,
        dataType: "json",
        success: function (response) {
            
            $("#submissionsTableContent").empty();

            if (!response.length) {
                $("#noSubmissionsMessage").show();
                return;
            }

            response.forEach((submission) => {
                displaySubmission(submission);
            });


        },
        error: function(error){
            console.log("AJAX-Request error: " + error);
        }
    });

</script>